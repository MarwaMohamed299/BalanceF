<div class="container mt-2">
  <h3 class="mb-4">Account Statement</h3>

  <!-- Filters Row -->
  <div class="row g-3 align-items-end mb-3">
    <!-- Account Search -->
    <div class="col-md-4 position-relative">
      <label class="form-label">Select Account</label>
      <input 
        type="text" 
        class="form-control" 
        [(ngModel)]="searchTerm"
        (input)="onSearchChange()"
        placeholder="Search account..."
      />

      <!-- Suggestions Dropdown -->
      <ul *ngIf="showSuggestions" 
          class="list-group position-absolute w-100 shadow-sm rounded" 
          style="z-index: 1050; max-height: 220px; overflow-y: auto;">
        <li 
          *ngFor="let acc of suggestions" 
          class="list-group-item list-group-item-action"
          (click)="selectAccount(acc)">
          {{ acc.accountName }}
        </li>
      </ul>
    </div>

    <!-- Date From -->
    <div class="col-md-3">
      <label class="form-label">From</label>
      <input type="date" [(ngModel)]="from" class="form-control" />
    </div>

    <!-- Date To -->
    <div class="col-md-3">
      <label class="form-label">To</label>
      <input type="date" [(ngModel)]="to" class="form-control" />
    </div>

    <!-- Action Buttons -->
    <div class="col-md-5 d-flex gap-2">
      <button class="btn btn-outline-secondary flex-fill" (click)="onPrint()">
        ğŸ–¨ Print
      </button>
      <button class="btn btn-outline-success flex-fill" (click)="onExportExcel()">
        ğŸ“Š Excel
      </button>
      <button class="btn btn-outline-primary flex-fill" (click)="getStatement()">
        ğŸ” Search
      </button>
    </div>
  </div>

  <!-- Table -->
  <div class="table-responsive shadow-sm rounded" id="table-data">
    <table class="table table-striped table-bordered align-middle text-center">
      <thead class="table-dark">
        <tr>
          <th>Account ID</th>
          <th>Account Name</th>
          <th>Date</th>
          <th>Previous Balance</th>
          <th>Debit</th>
          <th>Credit</th>
          <th>Final Balance</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <!-- âœ… Applied pagination pipe correctly -->
        <!-- <tr *ngFor="let row of (statement?.rows || []) | paginate: {  id : 'pagination',itemsPerPage: pageSize, currentPage: page, totalItems: totalItems }"> -->
          <tr *ngFor="let row of (statement?.data || []) 
  | paginate: { id: 'pagination', itemsPerPage: pageSize, currentPage: pageNumber, totalItems: totalCount }">

       <!-- <tr *ngFor="let row of statement?.data || []"> -->
  <td>{{ statement?.accountId }}</td>
  <td>{{ statement?.accountName }}</td>
  <td>{{ row.date | date:'yyyy-MM-dd HH:mm' }}</td>
  <td>{{ row.previousBalance | number:'1.2-2' }}</td>
  <td class="text-danger">{{ row.debit | number:'1.2-2' }}</td>
  <td class="text-success">{{ row.credit | number:'1.2-2' }}</td>
  <td class="fw-bold">{{ row.finalBalance | number:'1.2-2' }}</td>
  <td>
    <button class="btn btn-sm btn-info" (click)="openTransaction(row)">
      ğŸ” Details
    </button>
  </td>
</tr>

        <!-- Totals Row - Show only on first page or when no pagination -->
    <tr class="fw-bold table-secondary">
  <td colspan="3" class="text-end">Totals:</td>
  <td></td>
  <td class="text-danger">{{ statement?.totalDebit | number:'1.2-2' }}</td>
  <td class="text-success">{{ statement?.totalCredit | number:'1.2-2' }}</td>
  <td class="fw-bold">{{ statement?.finalBalance | number:'1.2-2' }}</td>
  <td></td>
</tr>

      </tbody>
    </table>

  </div>
<p>
  Showing page {{ pageNumber }} of {{ Math.ceil(totalCount / pageSize) }}
</p>

<pagination-controls
  id="pagination"
  [responsive]="true"
  (pageChange)="onPageChange($event)">
</pagination-controls>


<br><br><br><br>


  <!-- Modal -->
<div class="modal fade" id="transactionModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content shadow-lg">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title">
          <i class="fas fa-receipt me-2"></i>Transaction Details
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body" *ngIf="selectedTransaction">
        <div class="row g-3">
          <!-- Date -->
          <div class="col-md-6">
            <label class="form-label fw-bold text-muted">ğŸ“… Transaction Date</label>
            <div class="form-control-plaintext bg-light p-2 rounded">
              {{ selectedTransaction.date | date:'dd/MM/yyyy HH:mm:ss' }}
            </div>
          </div>

          <!-- Previous Balance -->
          <div class="col-md-6">
            <label class="form-label fw-bold text-muted">ğŸ’° Previous Balance</label>
            <div class="form-control-plaintext bg-light p-2 rounded">
              {{ selectedTransaction.previousBalance | number:'1.2-2' }}
            </div>
          </div>

          <!-- Debit Amount -->
          <div class="col-md-6">
            <label class="form-label fw-bold text-muted">ğŸ“¤ Debit Amount</label>
            <div class="form-control-plaintext bg-light p-2 rounded text-danger fw-bold">
              {{ selectedTransaction.debit | number:'1.2-2' }}
            </div>
          </div>

          <!-- Credit Amount -->
          <div class="col-md-6">
            <label class="form-label fw-bold text-muted">ğŸ“¥ Credit Amount</label>
            <div class="form-control-plaintext bg-light p-2 rounded text-success fw-bold">
              {{ selectedTransaction.credit | number:'1.2-2' }}
            </div>
          </div>

          <!-- Final Balance -->
          <div class="col-12">
            <label class="form-label fw-bold text-muted">ğŸ’µ Final Balance</label>
            <div class="form-control-plaintext bg-primary text-white p-3 rounded text-center fs-5 fw-bold">
              {{ selectedTransaction.finalBalance | number:'1.2-2' }}
            </div>
          </div>

          <!-- Remarks -->
          <div class="col-12" *ngIf="selectedTransaction.remarks">
            <label class="form-label fw-bold text-muted">ğŸ“ Remarks</label>
            <div class="border rounded p-3 bg-light">
              {{ getCleanRemarks(selectedTransaction.remarks) }}
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          <i class="fas fa-times me-1"></i>Close
        </button>
      </div>
    </div>
  </div>
</div>
